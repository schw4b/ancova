---
title: "24-Fujiwara"
author: "Audrey Yeo^[University of Zurich, audrey.yeo@uzh.ch]"
date: "01/06/2020"
output: pdf_document
toc: true
---

# Reference
Fujiwara, E. (2018). Looking at the eyes interferes with facial emotion recognition in alexithymia. *Journal of Abnormal Psychology*, 127(6), 571???577. https://doi.org/10.1037/abn0000361

```{r, include=FALSE}
# install.packages("biostatUZH", repos="http://R-Forge.R-project.org")
library(biostatUZH)
library(foreign) # for spss
library(ggplot2)
library(car) # for Anova
```

# Notes from reading methods section
This study assessed the two alexithymic groups, high and low, with the individuals' ability to identify clear and ambiguous blends of emotions in faces and their underlying visual attention patterns. Using the Toronto Alexithymia Scale, students with high alexithymia (HA, n = 73) or low alexithymia (LA, n = 76) were enrolled in this study. Participants judged the mixture ratio of emotional expressions while their eye movements were recorded. Controlling for group differences in mood and anxiety, HA showed similar accuracy but a reduced viewing preference of facial eye regions compared to LA (p < .02). More attention to the eye regions was related to lower accuracy in HA (p ???? .02) but to slightly higher accuracy in LA (p < .07).
* Dependant variable: c_an_dev (anger)
* Independant variable: TAS_group (high or low Alexithymia score), Emotion (6 levels), Ambiguity (2 levels)
* Covariate: 
  * DASS_tot (Depression, Anxiety and Stress total scores or DASS-21)
  * log_lat (log transformed response time)

# Reading data
Data is loaded, reshaped if necessary, and factors are specified.
```{r}
PATH = file.path(path.expand("~"), "Desktop", "CRS") # ancova project folder
# I created the .rda file with the following code, so it requires just to be loaded
# PATH1 = file.path(PATH, "dataPrimaryStudies", "24-Fujiwara", "24-Fujiwara-1.sav")
# spss_data <- file.choose(PATH1)
# spss_data <- read.spss(spss_data, to.data.frame = TRUE)
# data <- spss_data
# save(data, file = "../dataPrimaryStudies/24-Fujiwara/24-Fujiwara.rda")
# "Desktop/CRS/ancova/dataPrimaryStudies/24-Fujiwara/24-Fujiwara.rda")
load("../../ancova/dataPrimaryStudies/24-Fujiwara/24-Fujiwara.rda")
n_rows1 = length(data$TAS_group[data$TAS_group == "No Alexithymia"])*6 # group 1 is No Alexithymia
n_rows2 = length(data$TAS_group[data$TAS_group == "High Alexithymia"])*6 # group 2 is High Alexithymia
longdata = matrix(ncol = 7, nrow = n_rows1+n_rows2)
longdata = data.frame(longdata)
# newdata$Group =  data[data$TAS_group == "High Alexithymia",]
colnames(longdata) = c("id", "group", "amb", "emo", "dev", "cov1", "cov2")
longdata$id = c(rep(1:73, 6), rep(74:149, 6))
longdata$group = c(rep("NoA", 6*73), rep("HA", 6*76))
longdata$group = factor(longdata$group)
longdata$amb = c(rep("clear", 6*73), rep("notclear", 6*76))
emo1 = rep(c("anger", "disgust", "fear", "happiness", "sadness", "surprise"), 76)
emo2 = rep(c("anger", "disgust", "fear", "happiness", "sadness", "surprise"), 73)
longdata$emo = c(emo1, emo2)

longdata$dev = c( rep(data$c_an_dev[data$TAS_group == "No Alexithymia"],6) , rep(data$c_an_dev[data$TAS_group == "High Alexithymia"],6)) # dev = deviance scores, DV

longdata$time = c( rep(data$log_lat[data$TAS_group == "No Alexithymia"],6) , rep(data$log_lat[data$TAS_group == "High Alexithymia"],6)) # time = log of time, COV

longdata$dass = c( rep(data$log_lat[data$TAS_group == "No Alexithymia"],6) , rep(data$log_lat[data$TAS_group == "High Alexithymia"],6)) # dass = DASS_tot scores, COV
```

# Descriptives
## Dependant variable
Number of samples and mean (SD) in levels of the independant variables. We reproduce Table 3 and Figure 2A of the study.
```{r}
idx = c(1, 3, 2, 4) # sorting as in publication
tab.dv = array(NA, dim=c(2,3))
tab.dv[,1] = levels(longdata$group)
tab.dv[,2] = summary(longdata$group)
tab.dv[,3] = tapply(longdata$dev, longdata$group, 
                  function (x) sprintf("%0.2f (%0.2f)", mean(x), sd(x)))
colnames(tab.dv) = c("group", "n", "mean (SD)")
print(tab.dv)
```

```{r fig.height=2, fig.width=3.5}
ggplot(longdata, aes(y=dev, x=group, color=group)) +
  geom_boxplot() +
  geom_point(position = position_jitter(width = 0.15, height = 0)) +
  theme_minimal() +
  theme(axis.text.x = element_blank(), legend.title = element_blank()) +
  xlab("group") + ylab("anger score") + ggtitle("Dependant variable")
```

## Covariate(s)
The two covariates are DASS_tot scores and log of time.
```{r}
#idx = c(1, 3, 2, 4) # sorting as in publication
tab.cv = array(NA, dim=c(2,3))
tab.cv[,1] = levels(longdata$group)
tab.cv[,2] = summary(longdata$group)
tab.cv[,3] = tapply(longdata$dev, longdata$group, 
                  function (x) sprintf("%0.1f (%0.1f)", mean(x), sd(x)))
colnames(tab.cv) = c("group", "n", "mean (SD)")
tab.cv1 = tab.cv
print(tab.cv1)
```

```{r}
idx = c(1, 3, 2, 4) # sorting as in publication
tab.cv = array(NA, dim=c(3,3))
tab.cv[,1] = levels(longdata$group)
tab.cv[,2] = summary(longdata$group)
tab.cv[,3] = tapply(longdata$time, longdata$group, 
                  function (x) sprintf("%0.1f (%0.1f)", mean(x), sd(x)))
colnames(tab.cv) = c("group", "n", "mean (SD)")
tab.cv2 = tab.cv
print(tab.cv2)
```
```{r fig.height=2, fig.width=3.5, echo = FALSE}
ggplot(longdata, aes(y= dass, x=group, color=group)) +
  geom_boxplot() +
  geom_point(position = position_jitter(width = 0.15, height = 0)) +
  theme_minimal() +
  theme(axis.text.x = element_blank(), legend.title = element_blank()) +
  xlab("group") + ylab("Depression and Anxiety scores from DASS_21") + ggtitle("Covariate")
```

```{r fig.height=2, fig.width=3.5, echo = FALSE}
ggplot(longdata, aes(y=time, x=group, color=group)) +
  geom_boxplot() +
  geom_point(position = position_jitter(width = 0.15, height = 0)) +
  theme_minimal() +
  theme(axis.text.x = element_blank(), legend.title = element_blank()) +
  xlab("group") + ylab("log time (millisec)") + ggtitle("Covariate")
```

# Main analysis ANCOVA
```{r, include=FALSE}
stats.orig.IV = data.frame(
  Fvalue =  NA,
  df1 = NA,
  df2 = NA,
  pvalue = NA)

stats.orig.CV = stats.orig.IV

# enter all results from primary study here
stats.orig.IV$pvalue = "n.s." 
```


```{r}
# Orthogonal contrasts
# contrasts(data$TAS_group) = contr.helmert(2) #error
fit.ancova = aov(dev ~ dass + time + group, data = longdata)
#result = summary(fit.ancova) # Type I
#fit.lm = lm(dev ~dass + time + group, data = longdata)
result = Anova(fit.ancova, type=3) # Type III is appropriate due to imbalance design
print(result)
```

```{r, include=FALSE}
stats.rep.IV = data.frame(Fvalue = sprintf("%.2f",result$`F value`[3]),
                          df1 = result$Df[3],
                          df2 = result$Df[4],
                          pvalue = formatPval(result$`Pr(>F)`[3]))

stats.rep.CV = data.frame(Fvalue = sprintf("%.2f",result$`F value`[2]),
                          df1 = result$Df[2],
                          df2 = result$Df[4],
                          pvalue = formatPval(result$`Pr(>F)`[2]))
```

# Comparing ANCOVA in original study with reanalysis
## Independant variable
```{r}
tab.IV = rbind(stats.orig.IV, stats.rep.IV)
rownames(tab.IV) = c("original Study", "reanalysis")
print(t(tab.IV))
```

## Covariate
```{r}
tab.CV = rbind(stats.orig.CV, stats.rep.CV)
rownames(tab.CV) = c("original Study", "reanalysis")
print(t(tab.CV))
```

# Assumptions
## 1.  Homogeneity of variance
* ANOVA/ANCOVA is fairly robust in terms of the error rate when sample sizes are equal.
* When groups with larger sample sizes have larger variances than the groups with smaller sample sizes, the resulting F-ratio tends to be conservative. That is, it's more likely to produce a non-significant result when a genuine difference does exist in the population.
* Conversely, when the groups with larger sample sizes have smaller variances than the groups with smaller samples sizes, the resulting F-ratio tends to be liberal and can inflate the false positive rate.

There is a similar standard deviation between groups. There is no evidence of significance that there is no homogeneity of variance.
```{r}
tapply(longdata$dass, longdata$group, sd)
leveneTest(dass ~ group, data = longdata)
```


## 2.  Independence between covariate and IV
When the covariate and the experimental effect (independent variable) are not independent the treatment effect is obscured, spurious treatment effects can arise and the interpretation of the ANCOVA is seriously compromised.

We test whether our groups differ on the CV. If the groups do not significantly differ then is appropriate to use the covariate.

There is no evidence of significance, that groups differ in their covariances (DASS_total scores and log of time). Thus, these covariate is appropriate for this analysis.
```{r}
fit.cv1 = aov(longdata$dass ~ group, data = longdata) 
summary(fit.cv1)

fit.cv2 = aov(longdata$time ~ group, data = longdata) 
summary(fit.cv2)
```


## 3. Homogeneity of regression slopes

There is no evidence of significance that groups interact with DASS scores, this is confirmed on visual inspection.
```{r}
fit.hrs = aov(dev ~ dass*group, data = longdata)
Anova(fit.hrs, type=3)
```

```{r fig.height=2, fig.width=3.5}
ggplot(longdata, aes(y=dev, x=dass, color =group, shape=group)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, fullrange=TRUE) +
  theme_minimal() +
  theme(legend.title = element_blank()) +
  xlab("DASS-21 score") + ylab("anger")

```


# Notes

<!-- * The first reported ANCOVA which was n.s. was reproduced --> -->
* Assumptions were met for ancova analysis.

Data was analyzed according to recommendations by Field, Miles, & Field (2012).