---
title: "24-Fujiwara"
author: "Audrey Yeo^[University of Zurich, audrey.yeo@uzh.ch]"
date: "01/06/2020"
output: pdf_document
toc: true
---

# Reference
Fujiwara, E. (2018). Looking at the eyes interferes with facial emotion recognition in alexithymia. *Journal of Abnormal Psychology*, 127(6), 571-577. https://doi.org/10.1037/abn0000361

```{r, include=FALSE}
# install.packages("biostatUZH", repos="http://R-Forge.R-project.org")
library(biostatUZH)
library(foreign) # for spss
library(ggplot2)
library(car) # for Anova
library(cowplot)
```

# Notes from reading methods section
This study assessed the two Alexithymic groups, high and low, with the individuals' ability to identify clear and ambiguous blends of emotions in faces and their underlying visual attention patterns. Using the Toronto Alexithymia Scale, students with high alexithymia (HA, n = 73) or low alexithymia (LA, n = 76) were enrolled in this study. 
* Dependant variable: DEV (combination)
* Independant variable: TAS_group (high or low Alexithymia score), Emotion (6 levels), Ambiguity (2 levels)
* Covariate: 
  * DASS_tot (Depression, Anxiety and Stress total scores or DASS-21)
  * log_lat (log transformed response time)

# Reading data
Data is loaded, reshaped into long form, and factors are specified.
```{r, echo = FALSE}
# PATH = file.path(path.expand("~"), "Desktop", "CRS") # ancova project folder
# PATH1 = file.path(PATH, "dataPrimaryStudies", "24-Fujiwara", "24-Fujiwara-1.sav")
# spss_data <- file.choose(PATH1)
# spss_data <- read.spss(spss_data, to.data.frame = TRUE) # external window opens for this
# data <- spss_data
# save(data, file = "../dataPrimaryStudies/24-Fujiwara/24-Fujiwara.rda") # easier to call
load("../../ancova/dataPrimaryStudies/24-Fujiwara/24-Fujiwara.rda")

longdata = data.frame(dev = c(data.matrix(data[,4:15])))
longdata$id = as.factor(rep(1:149, 12))
longdata$TAS_group = as.factor(rep(data$TAS_group, 12))
longdata$TAS_group = factor(longdata$TAS_group, levels = c("No Alexithymia", "High Alexithymia"), ordered =TRUE)
longdata$amb = as.factor(c(rep("clear", 149*6), rep("ambigious", 149*6)))
longdata$emo = as.factor(c(rep("anger", 149), rep("disgust",149), rep("fear",149), rep("happiness", 149), rep( "sadness", 149), rep("surprise", 149)))
longdata$dass = rep(data$DASS_tot, 12)
longdata$time = rep(data$log_lat, 12)
```

# Descriptives
## Dependant variable
Number of samples and mean (SD) in levels of the independant variables. We reproduce Table 3 and Figure 2A of the study.
```{r}
idx = c(1, 3, 2, 4) # sorting as in publication
tab.dv = array(NA, dim=c(2,3))
tab.dv[,1] = levels(longdata$TAS_group)
tab.dv[,2] = summary(longdata$TAS_group)
tab.dv[,3] = tapply(longdata$dev, longdata$TAS_group, 
                  function (x) sprintf("%0.2f (%0.2f)", mean(x), sd(x)))
colnames(tab.dv) = c("group", "n", "mean (SD)")
print(tab.dv)
```

```{r fig.height=2, fig.width=3.5}
ggplot(longdata, aes(y=dev, x=TAS_group, color=TAS_group)) +
  geom_boxplot() +
  geom_point(position = position_jitter(width = 0.15, height = 0)) +
  theme_minimal() +
  theme(axis.text.x = element_blank(), legend.title = element_blank()) +
  xlab("group") + ylab("anger score") + ggtitle("Dependant variable")
```

## Covariate(s)
The two covariates are DASS_tot scores and log of time.
```{r}
#idx = c(1, 3, 2, 4) # sorting as in publication
tab.cv = array(NA, dim=c(2,3))
tab.cv[,1] = levels(longdata$TAS_group)
tab.cv[,2] = summary(longdata$TAS_group)
tab.cv[,3] = tapply(longdata$dass, longdata$TAS_group, 
                  function (x) sprintf("%0.1f (%0.1f)", mean(x), sd(x)))
colnames(tab.cv) = c("group", "n", "mean of DASS (SD)")
tab.cv1 = tab.cv
print(tab.cv1)
```

```{r }
p1 = ggplot(longdata, aes(y=dass, x=TAS_group, color=TAS_group)) +
  geom_boxplot() +
  geom_point(position = position_jitter(width = 0.15, height = 0)) +
  theme_minimal() +
  theme(axis.text.x = element_blank(), legend.title = element_blank()) +
  xlab("group") + ylab("DASS scores") + ggtitle("Covariate")
p2 = ggplot(longdata, aes(y=time, x=TAS_group, color=TAS_group)) +
  geom_boxplot() +
  geom_point(position = position_jitter(width = 0.15, height = 0)) +
  theme_minimal() +
  theme(axis.text.x = element_blank(), legend.title = element_blank()) +
  xlab("group") + ylab("log time (millisec)") + ggtitle("Covariate")
plot_grid(p1, p2, nrow = 1, ncol = 2)
```
Covariate log of time's mean and standard deviation
```{r}
idx = c(1, 3, 2, 4) # sorting as in publication
tab.cv = array(NA, dim=c(2,3))
tab.cv[,1] = levels(longdata$TAS_group)
tab.cv[,2] = summary(longdata$TAS_group)
tab.cv[,3] = tapply(longdata$time, longdata$TAS_group, 
                  function (x) sprintf("%0.1f (%0.1f)", mean(x), sd(x)))
colnames(tab.cv) = c("group", "n", "mean of log time (SD)")
tab.cv2 = tab.cv
print(tab.cv2)
```

# Main analysis ANCOVA
Independant variable: TAS_group (Between Group)
```{r, include=FALSE}
stats.orig.IV1 = data.frame(
  Fvalue =  0.83,
  df1 = 1,
  df2 = 145,
  pvalue = "0.57")
```
Independant variable: Ambiguity
```{r, include=FALSE}
stats.orig.IV2 = data.frame(
  Fvalue =  33.07,
  df1 = 1,
  df2 = 146,
  pvalue = "<0.001")
```

Independant variable: Emotion
```{r, include=FALSE}
stats.orig.IV3 = data.frame(
  Fvalue =  4.75,
  df1 = 4.72,
  df2 = 689.06,
  pvalue = "<0.001")
```


```{r}
# Orthogonal contrasts
contrasts(longdata$TAS_group) = contr.helmert(2) 
contrasts(longdata$amb) = contr.helmert(2) 
contrasts(longdata$emo) = contr.helmert(6) 

#aov(dev ~ time + dass + group*emo*amb + Error(id/(emo*amb)) + TAS_group, data = longdata)

fit.ancova = aov(dev ~ time + dass + TAS_group*emo*amb, data = longdata)
result = Anova(fit.ancova, type = "III")
print(result)
```

```{r, include=FALSE}
stats.rep.IV1 = data.frame(Fvalue = sprintf("%.2f",result$`F value`[4]),
                          df1 = result$Df[4],
                          df2 = result$Df[11],
                          pvalue = formatPval(result$`Pr(>F)`[4]))

stats.rep.IV2 = data.frame(Fvalue = sprintf("%.2f",result$`F value`[5]),
                          df1 = result$Df[5],
                          df2 = result$Df[11],
                          pvalue = formatPval(result$`Pr(>F)`[5]))

stats.rep.IV3 = data.frame(Fvalue = sprintf("%.2f",result$`F value`[6]),
                          df1 = result$Df[6],
                          df2 = result$Df[11],
                          pvalue = formatPval(result$`Pr(>F)`[6]))


```

# Comparing ANCOVA in original study with reanalysis
## Independant variable

```{r}
tab.IV = rbind(stats.orig.IV1, stats.rep.IV1, stats.orig.IV2, stats.rep.IV2,   stats.orig.IV3, stats.rep.IV3)
rownames(tab.IV) = c("orig TAS_group", "reanalysis TAS_group", "orig Ambiguity", "reanalysis Ambiguity", "orig Emotion", "reanalysis Emotion")
print(t(tab.IV))
```

## Covariate
```{r}
stats.orig.CV1 = data.frame(
  Fvalue =  NA,
  df1 = NA,
  df2 = NA,
  pvalue = NA)
stats.orig.CV2 = stats.orig.CV1
stats.rep.CV1 = data.frame(Fvalue = sprintf("%.2f",result$`F value`[1]),
                          df1 = result$Df[1],
                          df2 = result$Df[11],
                          pvalue = formatPval(result$`Pr(>F)`[1]))

stats.rep.CV2 = data.frame(Fvalue = sprintf("%.2f",result$`F value`[2]),
                          df1 = result$Df[2],
                          df2 = result$Df[11],
                          pvalue = formatPval(result$`Pr(>F)`[2]))
tab.CV = rbind(stats.orig.CV1, stats.orig.CV2, stats.rep.CV1, stats.rep.CV2)
rownames(tab.CV) = c("original Study COV : Time", "original Study COV: DASS", "reanalysis of COV : Time", "reanalysis of COV : DASS")
print(t(tab.CV))
```

# Assumptions
## 1.  Homogeneity of variance
There is a similar standard deviation between groups. There is no evidence of significance that there is no homogeneity of variance. F statistic shows evidence of significance.
```{r}
tapply(longdata$dass, longdata$TAS_group, sd)
leveneTest(dass ~ TAS_group, data = longdata)
```


## 2.  Independence between covariate and IV.
There is no evidence of significance, that groups differ in their DASS_total scores but marginal evidence that groups differ with log of time). Thus, these covariate is appropriate for this analysis.
```{r}
fit.cv1 = aov(longdata$dass ~ TAS_group, data = longdata) 
summary(fit.cv1)

fit.cv2 = aov(longdata$time ~ TAS_group, data = longdata) 
summary(fit.cv2)
```


## 3. Homogeneity of regression slopes
There is no evidence of significance that groups interact with DASS scores, neither does group interact with time, this is confirmed on visual inspection. This there is evidence of homogeneity of regression slopes for the DASS and time variables.
```{r}
fit.hrs = aov(dev ~ dass*TAS_group, data = longdata)
Anova(fit.hrs, type = "III") 

fit.hrs = aov(dev ~ time*TAS_group, data = longdata)
Anova(fit.hrs, type="III")
```

```{r }
p1 = ggplot(longdata, aes(y=dev, x=time, color = TAS_group, shape= TAS_group)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, fullrange=TRUE) +
  theme_minimal() +
  theme(legend.title = element_blank()) +
  xlab("Time") + ylab("Deviance scores")

p2 = ggplot(longdata, aes(y=dev, x=dass, color = TAS_group, shape= TAS_group)) +
  geom_point() +
  geom_smooth(formula = y ~ x, method=lm, se=FALSE, fullrange=TRUE) +
  theme_minimal() +
  theme(legend.title = element_blank()) +
  xlab("DASS-21 score") + ylab("Deviance scores")

plot_grid(p1, p2, nrow = 1, ncol = 2)
```


# Notes

<!-- * The first reported ANCOVA which was n.s. was reproduced --> -->
* Assumptions were met for ancova analysis except homogeneity of variance.
* Non-significant results were found in reanalysis
* The effect of Ambiguity had evidence of significant, with the main effects being very similar (23.19 in original student and 33.07 in reanalysis). The effect of Emotion has evidence of significance, though the effect is largely dissimilar. 
Data was analyzed according to recommendations by Field, Miles, & Field (2012).